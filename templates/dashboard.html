{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Table Bookings</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container py-5">

<!-- Logout button -->
    <div class="d-flex justify-content-end mb-3">
        <a href="{% url 'logout' %}" class="btn btn-outline-danger">Logout</a>
    </div>


    <div class="row g-4">
        <!-- Booking Form -->
        <div class="col-lg-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <form method="POST" action="{% url 'add_booking' %}">
                        {% csrf_token %}

                        <div class="mb-3">
                            <label class="form-label">Table Number</label>
                            <input type="number" name="table_number" class="form-control" min="1" max="10" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Date</label>
                            <input type="date" name="date" class="form-control" min="{{ current_date }}" required>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Time</label>
                            <input type="time" name="time" class="form-control" required>
                        </div>

                        <button type="submit" class="btn btn-success w-100">Add Booking</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Bookings List -->
        <div class="col-lg-8">
            <div class="card shadow-sm">
                <div class="card-body">
                    <ul class="list-group">
                        {% for booking in bookings %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span>
                                {{ booking.name }} - Table {{ booking.table_number }} on {{ booking.date }} at {{ booking.time }}
                            </span>
                            <span>
                                <a href="#" class="btn btn-sm btn-outline-primary"
                                onclick='openEditModal({
                                        "id": {{ booking.id }},
                                        "name": "{{ booking.name|escapejs }}",
                                        "table_number": {{ booking.table_number }},
                                        "date": "{{ booking.date }}",
                                        "time": "{{ booking.time }}"
                                })'>
                                    ‚úèÔ∏è
                                </a>
                                <a href="#" class="btn btn-sm btn-outline-danger" onclick="openDeleteModal({{ booking.id }})">
                                    üóëÔ∏è
                                </a>
                            </span>
                        </li>
                        {% empty %}
                        <li class="list-group-item text-center text-muted">
                            No active bookings.
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Delete Booking?</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this booking?
            </div>
            <div class="modal-footer">
                <a id="confirmDeleteBtn" class="btn btn-danger">Delete</a>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<!-- Edit Modal -->
<div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <form id="editBookingForm" method="POST">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title">Edit Booking</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" name="id" id="edit-id">

                    <div class="mb-3">
                        <label class="form-label">Full Names</label>
                        <input type="text" name="name" id="edit-name" class="form-control" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Table Number</label>
                        <input type="number" name="table_number" id="edit-table_number" class="form-control" min="1" max="10" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Date</label>
                        <input type="date" name="date" id="edit-date" class="form-control" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Time</label>
                        <input type="time" name="time" id="edit-time" class="form-control" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success">Save Changes</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    let deleteId = null;
    const deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
    const editModal = new bootstrap.Modal(document.getElementById('editModal'));

    function openDeleteModal(id) {
        deleteId = id;
        document.getElementById('confirmDeleteBtn').href = `/delete/${id}`;
        deleteModal.show();
    }

    function openEditModal(booking) {
        document.getElementById('edit-id').value = booking.id;
        document.getElementById('edit-name').value = booking.name;
        document.getElementById('edit-table_number').value = booking.table_number;
        document.getElementById('edit-date').value = booking.date;
        document.getElementById('edit-time').value = booking.time;
        editModal.show();
    }
</script>

</body>
</html>
